{% extends "base.html" %}

{% block title %}Ajuste Preventiva - Controle de Perdas{% endblock %}

{% block content %}
<article class="ajustepreventiva-page" role="main" aria-labelledby="page-title">
    <section class="ajustepreventiva-header" aria-label="Cabeçalho do ajuste preventiva">
        <div class="header-container">
            <header class="page-title">
                <h2 id="page-title">⚙️ Ajuste Preventiva</h2>
                <p class="page-subtitle">Sistema de contagem preventiva e ajustes automáticos por subgrupo</p>
            </header>
            
            <nav class="breadcrumb-nav">
                <a href="{{ url_for('controle_de_perdas.index') }}" class="breadcrumb-link">🏠 Início</a>
                <span class="breadcrumb-separator">></span>
                <a href="{{ url_for('controle_de_perdas.menu') }}" class="breadcrumb-link">📋 Menu</a>
                <span class="breadcrumb-separator">></span>
                <span class="breadcrumb-current">⚙️ Ajuste Preventiva</span>
            </nav>
        </div>
    </section>

    <section class="ajustepreventiva-summary" aria-label="Resumo geral dos ajustes preventivos">
        <div class="summary-container">
            <div class="summary-card total-subgrupos">
                <div class="summary-icon">📊</div>
                <div class="summary-content">
                    <h3>Total Subgrupos</h3>
                    <p class="summary-value">{{ total_subgrupos if total_subgrupos else '0' }}</p>
                    <span class="summary-label">Subgrupos monitorados</span>
                </div>
            </div>
            
            <div class="summary-card ajustes-pendentes">
                <div class="summary-icon">⏳</div>
                <div class="summary-content">
                    <h3>Ajustes Pendentes</h3>
                    <p class="summary-value">{{ ajustes_pendentes if ajustes_pendentes else '0' }}</p>
                    <span class="summary-label">Aguardando processamento</span>
                </div>
            </div>
            
            <div class="summary-card ajustes-realizados">
                <div class="summary-icon">✅</div>
                <div class="summary-content">
                    <h3>Ajustes Realizados</h3>
                    <p class="summary-value">{{ ajustes_realizados if ajustes_realizados else '0' }}</p>
                    <span class="summary-label">Hoje</span>
                </div>
            </div>
            
            <div class="summary-card economia-gerada">
                <div class="summary-icon">💰</div>
                <div class="summary-content">
                    <h3>Economia Gerada</h3>
                    <p class="summary-value">{{ economia_gerada if economia_gerada else 'R$ 0,00' }}</p>
                    <span class="summary-label">Este mês</span>
                </div>
            </div>
        </div>
    </section>

    <section class="ajustepreventiva-controls" aria-label="Controles de ajuste preventiva">
        <div class="controls-container">
            <div class="control-group">
                <h3>🎯 Ações Rápidas</h3>
                <div class="action-buttons">
                    <button class="action-btn primary" onclick="executarAjusteGeral()">
                        ⚡ Executar Ajuste Geral
                    </button>
                    <button class="action-btn secondary" onclick="simularAjustes()">
                        🔍 Simular Ajustes
                    </button>
                    <button class="action-btn success" onclick="exportarRelatorio()">
                        📊 Exportar Relatório
                    </button>
                    <button class="action-btn warning" onclick="configurarParametros()">
                        ⚙️ Configurar Parâmetros
                    </button>
                </div>
            </div>
            
            <div class="control-group">
                <h3>🔧 Filtros e Configurações</h3>
                <div class="filter-controls">
                    <div class="filter-item">
                        <label for="filter-subgrupo">Subgrupo:</label>
                        <select id="filter-subgrupo" class="filter-select">
                            <option value="all">Todos os Subgrupos</option>
                            {% if subgrupos_disponiveis %}
                                {% for subgrupo in subgrupos_disponiveis %}
                                <option value="{{ subgrupo.codigo }}">{{ subgrupo.nome }}</option>
                                {% endfor %}
                            {% endif %}
                        </select>
                    </div>
                    
                    <div class="filter-item">
                        <label for="filter-status">Status:</label>
                        <select id="filter-status" class="filter-select">
                            <option value="all">Todos</option>
                            <option value="pendente">Pendente</option>
                            <option value="processando">Processando</option>
                            <option value="concluido">Concluído</option>
                            <option value="erro">Erro</option>
                        </select>
                    </div>
                    
                    <div class="filter-item">
                        <label for="filter-prioridade">Prioridade:</label>
                        <select id="filter-prioridade" class="filter-select">
                            <option value="all">Todas</option>
                            <option value="alta">Alta</option>
                            <option value="media">Média</option>
                            <option value="baixa">Baixa</option>
                        </select>
                    </div>
                    
                    <div class="filter-item">
                        <label for="filter-valor-min">Valor Mín.:</label>
                        <input type="number" id="filter-valor-min" class="filter-input" placeholder="0,00" step="0.01">
                    </div>
                    
                    <button class="filter-btn" onclick="aplicarFiltros()">🔍 Aplicar</button>
                    <button class="filter-btn secondary" onclick="limparFiltros()">🗑️ Limpar</button>
                </div>
            </div>
        </div>
    </section>

    <section class="ajustepreventiva-grid" aria-label="Grid de subgrupos para ajuste preventiva">
        <div class="grid-container" id="subgrupos-grid">
            {% if subgrupos_data %}
                {% for subgrupo in subgrupos_data %}
                <div class="subgrupo-box" data-subgrupo="{{ subgrupo.codigo }}" data-status="{{ subgrupo.status }}" data-prioridade="{{ subgrupo.prioridade }}" data-valor="{{ subgrupo.valor_total }}">
                    <div class="subgrupo-header">
                        <div class="subgrupo-info">
                            <div class="subgrupo-title">
                                <h3>{{ subgrupo.nome }}</h3>
                                <span class="subgrupo-codigo">{{ subgrupo.codigo }}</span>
                            </div>
                            <div class="subgrupo-status">
                                <span class="status-badge {{ subgrupo.status }}">{{ subgrupo.status_text }}</span>
                                <span class="prioridade-badge {{ subgrupo.prioridade }}">{{ subgrupo.prioridade_text }}</span>
                            </div>
                        </div>
                        
                        <div class="subgrupo-actions">
                            <button class="subgrupo-btn expand" onclick="toggleSubgrupo('{{ subgrupo.codigo }}')" title="Expandir/Recolher">
                                📋
                            </button>
                            <button class="subgrupo-btn execute" onclick="executarAjuste('{{ subgrupo.codigo }}')" title="Executar Ajuste">
                                ⚡
                            </button>
                            <button class="subgrupo-btn simulate" onclick="simularAjuste('{{ subgrupo.codigo }}')" title="Simular">
                                🔍
                            </button>
                            <button class="subgrupo-btn config" onclick="configurarSubgrupo('{{ subgrupo.codigo }}')" title="Configurar">
                                ⚙️
                            </button>
                        </div>
                    </div>
                    
                    <div class="subgrupo-summary">
                        <div class="summary-metrics">
                            <div class="metric-item">
                                <div class="metric-icon">💰</div>
                                <div class="metric-content">
                                    <span class="metric-label">Valor Total</span>
                                    <span class="metric-value">{{ subgrupo.valor_total }}</span>
                                </div>
                            </div>
                            
                            <div class="metric-item">
                                <div class="metric-icon">📦</div>
                                <div class="metric-content">
                                    <span class="metric-label">Itens</span>
                                    <span class="metric-value">{{ subgrupo.total_itens }}</span>
                                </div>
                            </div>
                            
                            <div class="metric-item">
                                <div class="metric-icon">⚠️</div>
                                <div class="metric-content">
                                    <span class="metric-label">Pendências</span>
                                    <span class="metric-value">{{ subgrupo.pendencias }}</span>
                                </div>
                            </div>
                            
                            <div class="metric-item">
                                <div class="metric-icon">📈</div>
                                <div class="metric-content">
                                    <span class="metric-label">Eficiência</span>
                                    <span class="metric-value">{{ subgrupo.eficiencia }}%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="progress-container">
                            <div class="progress-info">
                                <span class="progress-label">Progresso do Ajuste</span>
                                <span class="progress-percentage">{{ subgrupo.progresso }}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ subgrupo.progresso }}%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="subgrupo-content" id="content-{{ subgrupo.codigo }}" style="display: none;">
                        <div class="content-tabs">
                            <button class="tab-btn active" onclick="showTab('{{ subgrupo.codigo }}', 'itens')">📦 Itens</button>
                            <button class="tab-btn" onclick="showTab('{{ subgrupo.codigo }}', 'historico')">📈 Histórico</button>
                            <button class="tab-btn" onclick="showTab('{{ subgrupo.codigo }}', 'configuracao')">⚙️ Configuração</button>
                            <button class="tab-btn" onclick="showTab('{{ subgrupo.codigo }}', 'logs')">📋 Logs</button>
                        </div>
                        
                        <!-- Tab Itens -->
                        <div class="tab-content" id="tab-itens-{{ subgrupo.codigo }}">
                            <div class="itens-controls">
                                <div class="controls-row">
                                    <button class="control-btn" onclick="selecionarTodos('{{ subgrupo.codigo }}')">
                                        ☑️ Selecionar Todos
                                    </button>
                                    <button class="control-btn" onclick="desselecionarTodos('{{ subgrupo.codigo }}')">
                                        ☐ Desselecionar Todos
                                    </button>
                                    <button class="control-btn primary" onclick="ajustarSelecionados('{{ subgrupo.codigo }}')">
                                        ⚡ Ajustar Selecionados
                                    </button>
                                    <button class="control-btn secondary" onclick="exportarItens('{{ subgrupo.codigo }}')">
                                        📊 Exportar
                                    </button>
                                </div>
                            </div>
                            
                            <div class="itens-table">
                                {% if subgrupo.itens %}
                                    <table class="itens-table-content">
                                        <thead>
                                            <tr>
                                                <th>
                                                    <input type="checkbox" id="select-all-{{ subgrupo.codigo }}" onchange="toggleSelectAll('{{ subgrupo.codigo }}')">
                                                </th>
                                                <th>Mercadoria</th>
                                                <th>Descrição</th>
                                                <th>Estoque Atual</th>
                                                <th>Estoque Sugerido</th>
                                                <th>Diferença</th>
                                                <th>Valor Ajuste</th>
                                                <th>Status</th>
                                                <th>Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for item in subgrupo.itens %}
                                            <tr class="item-row" data-item="{{ item.mercadoria }}">
                                                <td>
                                                    <input type="checkbox" class="item-checkbox" value="{{ item.mercadoria }}">
                                                </td>
                                                <td class="mercadoria">{{ item.mercadoria }}</td>
                                                <td class="descricao" title="{{ item.descricao }}">{{ item.descricao }}</td>
                                                <td class="estoque-atual">{{ item.estoque_atual }}</td>
                                                <td class="estoque-sugerido">{{ item.estoque_sugerido }}</td>
                                                <td class="diferenca {{ 'positive' if item.diferenca > 0 else 'negative' if item.diferenca < 0 else 'neutral' }}">
                                                    {{ item.diferenca }}
                                                </td>
                                                <td class="valor-ajuste">{{ item.valor_ajuste }}</td>
                                                <td class="status">
                                                    <span class="status-badge {{ item.status }}">{{ item.status_text }}</span>
                                                </td>
                                                <td class="actions">
                                                    <button class="action-btn" onclick="ajustarItem('{{ subgrupo.codigo }}', '{{ item.mercadoria }}')" title="Ajustar">
                                                        ⚡
                                                    </button>
                                                    <button class="action-btn" onclick="editarItem('{{ subgrupo.codigo }}', '{{ item.mercadoria }}')" title="Editar">
                                                        ✏️
                                                    </button>
                                                    <button class="action-btn" onclick="verDetalhes('{{ subgrupo.codigo }}', '{{ item.mercadoria }}')" title="Detalhes">
                                                        👁️
                                                    </button>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                {% else %}
                                    <div class="no-data">
                                        <p>Nenhum item encontrado para este subgrupo</p>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Tab Histórico -->
                        <div class="tab-content" id="tab-historico-{{ subgrupo.codigo }}" style="display: none;">
                            <div class="historico-container">
                                <div class="historico-filters">
                                    <select class="historico-filter">
                                        <option value="7">Últimos 7 dias</option>
                                        <option value="30">Últimos 30 dias</option>
                                        <option value="90">Últimos 90 dias</option>
                                    </select>
                                    <button class="filter-btn" onclick="atualizarHistorico('{{ subgrupo.codigo }}')">🔄 Atualizar</button>
                                </div>
                                
                                {% if subgrupo.historico %}
                                    <div class="historico-chart">
                                        <div class="chart-header">
                                            <h4>📈 Evolução dos Ajustes</h4>
                                        </div>
                                        <div class="chart-content">
                                            {% for registro in subgrupo.historico %}
                                            <div class="historico-item">
                                                <div class="historico-date">{{ registro.data }}</div>
                                                <div class="historico-info">
                                                    <div class="historico-action">{{ registro.acao }}</div>
                                                    <div class="historico-details">{{ registro.detalhes }}</div>
                                                </div>
                                                <div class="historico-value">{{ registro.valor }}</div>
                                                <div class="historico-status">
                                                    <span class="status-badge {{ registro.status }}">{{ registro.status_text }}</span>
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    
                                    <div class="historico-stats">
                                        <div class="stat-card">
                                            <div class="stat-icon">📊</div>
                                            <div class="stat-content">
                                                <div class="stat-value">{{ subgrupo.stats.total_ajustes }}</div>
                                                <div class="stat-label">Total de Ajustes</div>
                                            </div>
                                        </div>
                                        
                                        <div class="stat-card">
                                            <div class="stat-icon">💰</div>
                                            <div class="stat-content">
                                                <div class="stat-value">{{ subgrupo.stats.valor_total }}</div>
                                                <div class="stat-label">Valor Total</div>
                                            </div>
                                        </div>
                                        
                                        <div class="stat-card">
                                            <div class="stat-icon">📈</div>
                                            <div class="stat-content">
                                                <div class="stat-value">{{ subgrupo.stats.media_diaria }}</div>
                                                <div class="stat-label">Média Diária</div>
                                            </div>
                                        </div>
                                        
                                        <div class="stat-card">
                                            <div class="stat-icon">✅</div>
                                            <div class="stat-content">
                                                <div class="stat-value">{{ subgrupo.stats.taxa_sucesso }}%</div>
                                                <div class="stat-label">Taxa de Sucesso</div>
                                            </div>
                                        </div>
                                    </div>
                                {% else %}
                                    <div class="no-data">
                                        <p>Nenhum histórico disponível para este subgrupo</p>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Tab Configuração -->
                        <div class="tab-content" id="tab-configuracao-{{ subgrupo.codigo }}" style="display: none;">
                            <div class="configuracao-container">
                                <form class="configuracao-form" onsubmit="salvarConfiguracao('{{ subgrupo.codigo }}', event)">
                                    <div class="config-section">
                                        <h4>⚙️ Parâmetros de Ajuste</h4>
                                        <div class="config-grid">
                                            <div class="config-item">
                                                <label for="limite-ajuste-{{ subgrupo.codigo }}">Limite de Ajuste (%):</label>
                                                <input type="number" id="limite-ajuste-{{ subgrupo.codigo }}" value="{{ subgrupo.config.limite_ajuste if subgrupo.config else '10' }}" min="0" max="100" step="0.1">
                                            </div>
                                            
                                            <div class="config-item">
                                                <label for="valor-minimo-{{ subgrupo.codigo }}">Valor Mínimo (R$):</label>
                                                <input type="number" id="valor-minimo-{{ subgrupo.codigo }}" value="{{ subgrupo.config.valor_minimo if subgrupo.config else '1.00' }}" min="0" step="0.01">
                                            </div>
                                            
                                            <div class="config-item">
                                                <label for="frequencia-{{ subgrupo.codigo }}">Frequência:</label>
                                                <select id="frequencia-{{ subgrupo.codigo }}">
                                                    <option value="diario" {{ 'selected' if subgrupo.config.frequencia == 'diario' else '' }}>Diário</option>
                                                    <option value="semanal" {{ 'selected' if subgrupo.config.frequencia == 'semanal' else '' }}>Semanal</option>
                                                    <option value="mensal" {{ 'selected' if subgrupo.config.frequencia == 'mensal' else '' }}>Mensal</option>
                                                </select>
                                            </div>
                                            
                                            <div class="config-item">
                                                <label for="auto-ajuste-{{ subgrupo.codigo }}">Ajuste Automático:</label>
                                                <input type="checkbox" id="auto-ajuste-{{ subgrupo.codigo }}" {{ 'checked' if subgrupo.config.auto_ajuste else '' }}>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="config-section">
                                        <h4>🔔 Notificações</h4>
                                        <div class="config-grid">
                                            <div class="config-item">
                                                <label for="notif-email-{{ subgrupo.codigo }}">Email:</label>
                                                <input type="email" id="notif-email-{{ subgrupo.codigo }}" value="{{ subgrupo.config.email if subgrupo.config else '' }}" placeholder="email@exemplo.com">
                                            </div>
                                            
                                            <div class="config-item">
                                                <label for="notif-sucesso-{{ subgrupo.codigo }}">Notificar Sucesso:</label>
                                                <input type="checkbox" id="notif-sucesso-{{ subgrupo.codigo }}" {{ 'checked' if subgrupo.config.notif_sucesso else '' }}>
                                            </div>
                                            
                                            <div class="config-item">
                                                <label for="notif-erro-{{ subgrupo.codigo }}">Notificar Erro:</label>
                                                <input type="checkbox" id="notif-erro-{{ subgrupo.codigo }}" {{ 'checked' if subgrupo.config.notif_erro else '' }}>
                                            </div>
                                            
                                            <div class="config-item">
                                                <label for="notif-limite-{{ subgrupo.codigo }}">Notificar Limite:</label>
                                                <input type="checkbox" id="notif-limite-{{ subgrupo.codigo }}" {{ 'checked' if subgrupo.config.notif_limite else '' }}>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="config-actions">
                                        <button type="submit" class="config-btn primary">💾 Salvar Configuração</button>
                                        <button type="button" class="config-btn secondary" onclick="resetarConfiguracao('{{ subgrupo.codigo }}')">🔄 Resetar</button>
                                        <button type="button" class="config-btn warning" onclick="testarConfiguracao('{{ subgrupo.codigo }}')">🧪 Testar</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Tab Logs -->
                        <div class="tab-content" id="tab-logs-{{ subgrupo.codigo }}" style="display: none;">
                            <div class="logs-container">
                                <div class="logs-controls">
                                    <select class="logs-filter" id="logs-level-{{ subgrupo.codigo }}">
                                        <option value="all">Todos os Níveis</option>
                                        <option value="info">Info</option>
                                        <option value="warning">Warning</option>
                                        <option value="error">Error</option>
                                        <option value="debug">Debug</option>
                                    </select>
                                    <button class="logs-btn" onclick="atualizarLogs('{{ subgrupo.codigo }}')">🔄 Atualizar</button>
                                    <button class="logs-btn" onclick="limparLogs('{{ subgrupo.codigo }}')">🗑️ Limpar</button>
                                    <button class="logs-btn" onclick="exportarLogs('{{ subgrupo.codigo }}')">📊 Exportar</button>
                                </div>
                                
                                <div class="logs-content" id="logs-content-{{ subgrupo.codigo }}">
                                    {% if subgrupo.logs %}
                                        {% for log in subgrupo.logs %}
                                        <div class="log-entry {{ log.level }}">
                                            <div class="log-timestamp">{{ log.timestamp }}</div>
                                            <div class="log-level">
                                                <span class="level-badge {{ log.level }}">{{ log.level.upper() }}</span>
                                            </div>
                                            <div class="log-message">{{ log.message }}</div>
                                            {% if log.details %}
                                            <div class="log-details">
                                                <button class="details-toggle" onclick="toggleLogDetails('{{ loop.index }}')">
                                                    📋 Detalhes
                                                </button>
                                                <div class="details-content" id="details-{{ loop.index }}" style="display: none;">
                                                    <pre>{{ log.details }}</pre>
                                                </div>
                                            </div>
                                            {% endif %}
                                        </div>
                                        {% endfor %}
                                    {% else %}
                                        <div class="no-data">
                                            <p>Nenhum log disponível para este subgrupo</p>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-subgrupos">
                    <div class="no-subgrupos-icon">⚙️</div>
                    <h3>Nenhum subgrupo configurado</h3>
                    <p>Configure subgrupos para começar a usar o ajuste preventiva</p>
                    <button class="setup-btn" onclick="configurarSubgrupos()">⚙️ Configurar Subgrupos</button>
                </div>
            {% endif %}
        </div>
    </section>

    <section class="ajustepreventiva-dashboard" aria-label="Dashboard de monitoramento">
        <div class="dashboard-container">
            <div class="dashboard-card performance">
                <div class="card-header">
                    <h3>📊 Performance Geral</h3>
                    <div class="card-actions">
                        <button class="card-btn" onclick="atualizarPerformance()">🔄</button>
                        <button class="card-btn" onclick="exportarPerformance()">📊</button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="performance-metrics">
                        <div class="metric-row">
                            <div class="metric-label">Taxa de Sucesso:</div>
                            <div class="metric-value success">{{ performance.taxa_sucesso if performance else '95' }}%</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Tempo Médio:</div>
                            <div class="metric-value">{{ performance.tempo_medio if performance else '2.5' }}min</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Economia Total:</div>
                            <div class="metric-value success">{{ performance.economia_total if performance else 'R$ 15.750,00' }}</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Ajustes Hoje:</div>
                            <div class="metric-value">{{ performance.ajustes_hoje if performance else '127' }}</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-card alertas">
                <div class="card-header">
                    <h3>⚠️ Alertas e Notificações</h3>
                    <div class="card-actions">
                        <button class="card-btn" onclick="atualizarAlertas()">🔄</button>
                        <button class="card-btn" onclick="marcarTodosLidos()">✅</button>
                    </div>
                </div>
                <div class="card-content">
                    {% if alertas %}
                        <div class="alertas-list">
                            {% for alerta in alertas %}
                            <div class="alerta-item {{ alerta.tipo }}">
                                <div class="alerta-icon">
                                    {% if alerta.tipo == 'error' %}❌
                                    {% elif alerta.tipo == 'warning' %}⚠️
                                    {% elif alerta.tipo == 'info' %}ℹ️
                                    {% else %}✅{% endif %}
                                </div>
                                <div class="alerta-content">
                                    <div class="alerta-title">{{ alerta.titulo }}</div>
                                    <div class="alerta-message">{{ alerta.mensagem }}</div>
                                    <div class="alerta-time">{{ alerta.timestamp }}</div>
                                </div>
                                <div class="alerta-actions">
                                    <button class="alerta-btn" onclick="resolverAlerta('{{ alerta.id }}')">✅</button>
                                    <button class="alerta-btn" onclick="verDetalhesAlerta('{{ alerta.id }}')">👁️</button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="no-data">
                            <p>Nenhum alerta no momento</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="dashboard-card agenda">
                <div class="card-header">
                    <h3>📅 Agenda de Ajustes</h3>
                    <div class="card-actions">
                        <button class="card-btn" onclick="atualizarAgenda()">🔄</button>
                        <button class="card-btn" onclick="adicionarAgenda()">➕</button>
                    </div>
                </div>
                <div class="card-content">
                    {% if agenda %}
                        <div class="agenda-list">
                            {% for item in agenda %}
                            <div class="agenda-item">
                                <div class="agenda-time">{{ item.horario }}</div>
                                <div class="agenda-content">
                                    <div class="agenda-title">{{ item.titulo }}</div>
                                    <div class="agenda-subgrupo">{{ item.subgrupo }}</div>
                                </div>
                                <div class="agenda-status">
                                    <span class="status-badge {{ item.status }}">{{ item.status_text }}</span>
                                </div>
                                <div class="agenda-actions">
                                    <button class="agenda-btn" onclick="executarAgenda('{{ item.id }}')">▶️</button>
                                    <button class="agenda-btn" onclick="editarAgenda('{{ item.id }}')">✏️</button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="no-data">
                            <p>Nenhum ajuste agendado</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>
</article>

<!-- Modal para Configuração de Parâmetros -->
<div id="parametros-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>⚙️ Configuração de Parâmetros Globais</h3>
            <span class="modal-close">&times;</span>
        </div>
        <div class="modal-body">
            <div id="parametros-content">
                <!-- Conteúdo será preenchido via JavaScript -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="modal-btn primary" onclick="salvarParametrosGlobais()">💾 Salvar</button>
            <button class="modal-btn secondary" onclick="resetarParametrosGlobais()">🔄 Resetar</button>
            <button class="modal-btn secondary" onclick="closeModal()">❌ Fechar</button>
        </div>
    </div>
</div>

<!-- Modal para Detalhes do Item -->
<div id="item-details-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>📦 Detalhes do Item</h3>
            <span class="modal-close">&times;</span>
        </div>
        <div class="modal-body">
            <div id="item-details-content">
                <!-- Conteúdo será preenchido via JavaScript -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="modal-btn primary" onclick="ajustarItemModal()">⚡ Ajustar</button>
            <button class="modal-btn warning" onclick="editarItemModal()">✏️ Editar</button>
            <button class="modal-btn secondary" onclick="closeModal()">❌ Fechar</button>
        </div>
    </div>
</div>

<style>
.ajustepreventiva-page {
    max-width: 1800px;
    margin: 0 auto;
    padding: 20px;
}

.header-container {
    text-align: center;
    margin-bottom: 30px;
}

.page-title h2 {
    color: #3498db;
    font-size: 2.5rem;
    margin-bottom: 10px;
}

.page-subtitle {
    color: #7f8c8d;
    font-size: 1.1rem;
    margin-bottom: 20px;
}

.breadcrumb-nav {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-top: 15px;
}

.breadcrumb-link {
    color: #3498db;
    text-decoration: none;
    padding: 5px 10px;
    border-radius: 5px;
    transition: background-color 0.3s;
}

.breadcrumb-link:hover {
    background-color: #ecf0f1;
}

.breadcrumb-separator {
    color: #bdc3c7;
}

.breadcrumb-current {
    color: #2c3e50;
    font-weight: bold;
}

.summary-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.summary-card {
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    gap: 20px;
}

.summary-card.total-subgrupos {
    border-left: 5px solid #3498db;
}

.summary-card.ajustes-pendentes {
    border-left: 5px solid #f39c12;
}

.summary-card.ajustes-realizados {
    border-left: 5px solid #27ae60;
}

.summary-card.economia-gerada {
    border-left: 5px solid #e74c3c;
}

.summary-icon {
    font-size: 3rem;
    opacity: 0.8;
}

.summary-content h3 {
    color: #2c3e50;
    margin-bottom: 10px;
    font-size: 1.2rem;
}

.summary-value {
    font-size: 1.8rem;
    font-weight: bold;
    color: #2c3e50;
    margin: 0;
}

.summary-label {
    color: #7f8c8d;
    font-size: 0.9rem;
}

.controls-container {
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin-bottom: 30px;
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 30px;
}

.control-group h3 {
    color: #2c3e50;
    margin-bottom: 20px;
    font-size: 1.2rem;
}

.action-buttons {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.action-btn {
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s;
    text-align: left;
}

.action-btn.primary {
    background: #3498db;
    color: white;
}

.action-btn.primary:hover {
    background: #2980b9;
    transform: translateY(-1px);
}

.action-btn.secondary {
    background: #95a5a6;
    color: white;
}

.action-btn.secondary:hover {
    background: #7f8c8d;
    transform: translateY(-1px);
}

.action-btn.success {
    background: #27ae60;
    color: white;
}

.action-btn.success:hover {
    background: #229954;
    transform: translateY(-1px);
}

.action-btn.warning {
    background: #f39c12;
    color: white;
}

.action-btn.warning:hover {
    background: #e67e22;
    transform: translateY(-1px);
}

.filter-controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    align-items: end;
}

.filter-item {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.filter-item label {
    color: #2c3e50;
    font-weight: 500;
    font-size: 0.9rem;
}

.filter-select, .filter-input {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 0.9rem;
    background: white;
}

.filter-select:focus, .filter-input:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
}

.filter-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s;
    background: #3498db;
    color: white;
}

.filter-btn:hover {
    background: #2980b9;
    transform: translateY(-1px);
}

.filter-btn.secondary {
    background: #95a5a6;
}

.filter-btn.secondary:hover {
    background: #7f8c8d;
}

.grid-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
}

.subgrupo-box {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    transition: all 0.3s;
}

.subgrupo-box:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
}

.subgrupo-header {
    background: #f8f9fa;
    padding: 20px;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.subgrupo-info {
    flex: 1;
}

.subgrupo-title {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.subgrupo-title h3 {
    color: #2c3e50;
    margin: 0;
    font-size: 1.3rem;
}

.subgrupo-codigo {
    color: #7f8c8d;
    font-size: 0.9rem;
    background: #ecf0f1;
    padding: 4px 8px;
    border-radius: 4px;
}

.subgrupo-status {
    display: flex;
    gap: 10px;
}

.status-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 500;
}

.status-badge.pendente {
    background: #fff3cd;
    color: #856404;
}

.status-badge.processando {
    background: #d1ecf1;
    color: #0c5460;
}

.status-badge.concluido {
    background: #d4edda;
    color: #155724;
}

.status-badge.erro {
    background: #f8d7da;
    color: #721c24;
}

.prioridade-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 500;
}

.prioridade-badge.alta {
    background: #f8d7da;
    color: #721c24;
}

.prioridade-badge.media {
    background: #fff3cd;
    color: #856404;
}

.prioridade-badge.baixa {
    background: #d4edda;
    color: #155724;
}

.subgrupo-actions {
    display: flex;
    gap: 8px;
}

.subgrupo-btn {
    padding: 8px 12px;
    border: none;
    border-radius: 6px;
    background: #ecf0f1;
    color: #2c3e50;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 0.9rem;
}

.subgrupo-btn:hover {
    background: #bdc3c7;
    transform: translateY(-1px);
}

.subgrupo-btn.execute {
    background: #3498db;
    color: white;
}

.subgrupo-btn.execute:hover {
    background: #2980b9;
}

.subgrupo-summary {
    padding: 20px;
}

.summary-metrics {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-bottom: 20px;
}

.metric-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
}

.metric-icon {
    font-size: 1.5rem;
    opacity: 0.8;
}

.metric-content {
    flex: 1;
}

.metric-label {
    display: block;
    color: #7f8c8d;
    font-size: 0.85rem;
    margin-bottom: 5px;
}

.metric-value {
    display: block;
    color: #2c3e50;
    font-size: 1.1rem;
    font-weight: bold;
}

.progress-container {
    margin-top: 15px;
}

.progress-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.progress-label {
    color: #7f8c8d;
    font-size: 0.9rem;
}

.progress-percentage {
    color: #2c3e50;
    font-weight: bold;
    font-size: 0.9rem;
}

.progress-bar {
    background: #ecf0f1;
    border-radius: 10px;
    height: 20px;
    position: relative;
    overflow: hidden;
}

.progress-fill {
    background: linear-gradient(90deg, #3498db, #2980b9);
    height: 100%;
    transition: width 0.3s ease;
    border-radius: 10px;
}

.subgrupo-content {
    border-top: 1px solid #dee2e6;
}

.content-tabs {
    display: flex;
    background: #f8f9fa;
}

.tab-btn {
    flex: 1;
    padding: 15px;
    border: none;
    background: transparent;
    color: #7f8c8d;
    cursor: pointer;
    transition: all 0.3s;
    border-bottom: 3px solid transparent;
}

.tab-btn.active {
    color: #3498db;
    border-bottom-color: #3498db;
    background: white;
}

.tab-btn:hover {
    color: #2c3e50;
    background: #ecf0f1;
}

.tab-content {
    padding: 25px;
}

.itens-controls {
    margin-bottom: 20px;
}

.controls-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.control-btn {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s;
    background: #ecf0f1;
    color: #2c3e50;
}

.control-btn:hover {
    background: #bdc3c7;
    transform: translateY(-1px);
}

.control-btn.primary {
    background: #3498db;
    color: white;
}

.control-btn.primary:hover {
    background: #2980b9;
}

.control-btn.secondary {
    background: #95a5a6;
    color: white;
}

.control-btn.secondary:hover {
    background: #7f8c8d;
}

.itens-table {
    max-height: 400px;
    overflow: auto;
    border-radius: 8px;
    border: 1px solid #dee2e6;
}

.itens-table-content {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
}

.itens-table-content th {
    background: #f8f9fa;
    color: #2c3e50;
    padding: 12px 8px;
    text-align: left;
    border-bottom: 2px solid #dee2e6;
    position: sticky;
    top: 0;
    z-index: 10;
}

.itens-table-content td {
    padding: 10px 8px;
    border-bottom: 1px solid #dee2e6;
}

.itens-table-content tr:hover {
    background-color: #f8f9fa;
}

.mercadoria {
    font-weight: 500;
    color: #2c3e50;
}

.descricao {
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.estoque-atual, .estoque-sugerido {
    text-align: center;
    font-weight: 500;
}

.diferenca {
    text-align: center;
    font-weight: bold;
}

.diferenca.positive {
    color: #27ae60;
}

.diferenca.negative {
    color: #e74c3c;
}

.diferenca.neutral {
    color: #7f8c8d;
}

.valor-ajuste {
    font-weight: bold;
    color: #e74c3c;
    text-align: right;
}

.actions {
    display: flex;
    gap: 5px;
    justify-content: center;
}

.action-btn {
    padding: 6px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 0.8rem;
    background: #ecf0f1;
}

.action-btn:hover {
    transform: scale(1.1);
    background: #bdc3c7;
}

.historico-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.historico-filters {
    display: flex;
    gap: 10px;
    align-items: center;
}

.historico-filter {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 0.9rem;
    background: white;
}

.historico-chart {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
}

.chart-header {
    margin-bottom: 20px;
}

.chart-header h4 {
    color: #2c3e50;
    margin: 0;
}

.chart-content {
    display: flex;
    flex-direction: column;
    gap: 15px;
    max-height: 300px;
    overflow-y: auto;
}

.historico-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: white;
    border-radius: 8px;
    border-left: 3px solid #3498db;
}

.historico-date {
    color: #7f8c8d;
    font-size: 0.85rem;
    min-width: 80px;
}

.historico-info {
    flex: 1;
}

.historico-action {
    color: #2c3e50;
    font-weight: 500;
    margin-bottom: 5px;
}

.historico-details {
    color: #7f8c8d;
    font-size: 0.85rem;
}

.historico-value {
    color: #e74c3c;
    font-weight: bold;
    min-width: 100px;
    text-align: right;
}

.historico-status {
    min-width: 80px;
}

.historico-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.stat-card {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
}

.stat-icon {
    font-size: 2rem;
    opacity: 0.8;
}

.stat-content {
    flex: 1;
}

.stat-value {
    color: #2c3e50;
    font-size: 1.3rem;
    font-weight: bold;
    margin-bottom: 5px;
}

.stat-label {
    color: #7f8c8d;
    font-size: 0.9rem;
}

.configuracao-container {
    max-height: 400px;
    overflow-y: auto;
}

.configuracao-form {
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.config-section {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
}

.config-section h4 {
    color: #2c3e50;
    margin-bottom: 20px;
    font-size: 1.1rem;
}

.config-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.config-item {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.config-item label {
    color: #2c3e50;
    font-weight: 500;
    font-size: 0.9rem;
}

.config-item input, .config-item select {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 0.9rem;
    background: white;
}

.config-item input:focus, .config-item select:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
}

.config-actions {
    display: flex;
    gap: 15px;
    justify-content: flex-end;
}

.config-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s;
}

.config-btn.primary {
    background: #3498db;
    color: white;
}

.config-btn.primary:hover {
    background: #2980b9;
}

.config-btn.secondary {
    background: #95a5a6;
    color: white;
}

.config-btn.secondary:hover {
    background: #7f8c8d;
}

.config-btn.warning {
    background: #f39c12;
    color: white;
}

.config-btn.warning:hover {
    background: #e67e22;
}

.logs-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.logs-controls {
    display: flex;
    gap: 10px;
    align-items: center;
}

.logs-filter {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 0.9rem;
    background: white;
}

.logs-btn {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s;
    background: #ecf0f1;
    color: #2c3e50;
}

.logs-btn:hover {
    background: #bdc3c7;
    transform: translateY(-1px);
}

.logs-content {
    background: #2c3e50;
    border-radius: 8px;
    padding: 20px;
    max-height: 300px;
    overflow-y: auto;
    font-family: 'Courier New', monospace;
}

.log-entry {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    padding: 10px 0;
    border-bottom: 1px solid #34495e;
}

.log-entry:last-child {
    border-bottom: none;
}

.log-timestamp {
    color: #bdc3c7;
    font-size: 0.8rem;
    min-width: 120px;
}

.log-level {
    min-width: 80px;
}

.level-badge {
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: bold;
}

.level-badge.info {
    background: #3498db;
    color: white;
}

.level-badge.warning {
    background: #f39c12;
    color: white;
}

.level-badge.error {
    background: #e74c3c;
    color: white;
}

.level-badge.debug {
    background: #95a5a6;
    color: white;
}

.log-message {
    flex: 1;
    color: #ecf0f1;
    font-size: 0.9rem;
}

.log-details {
    margin-top: 10px;
}

.details-toggle {
    background: #34495e;
    color: #ecf0f1;
    border: 1px solid #7f8c8d;
    padding: 4px 8px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.8rem;
}

.details-toggle:hover {
    background: #7f8c8d;
}

.details-content {
    margin-top: 10px;
    padding: 10px;
    background: #34495e;
    border-radius: 4px;
    border: 1px solid #7f8c8d;
}

.details-content pre {
    color: #ecf0f1;
    font-size: 0.8rem;
    margin: 0;
    white-space: pre-wrap;
}

.no-subgrupos {
    grid-column: 1 / -1;
    text-align: center;
    color: #7f8c8d;
    padding: 80px 20px;
}

.no-subgrupos-icon {
    font-size: 5rem;
    margin-bottom: 20px;
    opacity: 0.5;
}

.no-subgrupos h3 {
    font-size: 1.5rem;
    margin-bottom: 10px;
}

.no-subgrupos p {
    font-size: 1.1rem;
    margin-bottom: 20px;
}

.setup-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    background: #3498db;
    color: white;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s;
}

.setup-btn:hover {
    background: #2980b9;
    transform: translateY(-2px);
}

.dashboard-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 25px;
}

.dashboard-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.card-header {
    background: #f8f9fa;
    padding: 20px;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.card-header h3 {
    color: #2c3e50;
    margin: 0;
    font-size: 1.2rem;
}

.card-actions {
    display: flex;
    gap: 8px;
}

.card-btn {
    padding: 6px 10px;
    border: none;
    border-radius: 4px;
    background: #ecf0f1;
    color: #2c3e50;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 0.9rem;
}

.card-btn:hover {
    background: #bdc3c7;
    transform: translateY(-1px);
}

.card-content {
    padding: 20px;
}

.performance-metrics {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.metric-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid #ecf0f1;
}

.metric-row:last-child {
    border-bottom: none;
}

.metric-label {
    color: #7f8c8d;
    font-size: 0.9rem;
}

.metric-value {
    color: #2c3e50;
    font-weight: bold;
    font-size: 1rem;
}

.metric-value.success {
    color: #27ae60;
}

.alertas-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
    max-height: 300px;
    overflow-y: auto;
}

.alerta-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #3498db;
}

.alerta-item.error {
    border-left-color: #e74c3c;
    background: #fdf2f2;
}

.alerta-item.warning {
    border-left-color: #f39c12;
    background: #fefbf3;
}

.alerta-item.info {
    border-left-color: #3498db;
    background: #f4f8fb;
}

.alerta-icon {
    font-size: 1.2rem;
}

.alerta-content {
    flex: 1;
}

.alerta-title {
    color: #2c3e50;
    font-weight: 500;
    margin-bottom: 5px;
}

.alerta-message {
    color: #7f8c8d;
    font-size: 0.9rem;
    margin-bottom: 5px;
}

.alerta-time {
    color: #bdc3c7;
    font-size: 0.8rem;
}

.alerta-actions {
    display: flex;
    gap: 5px;
}

.alerta-btn {
    padding: 6px;
    border: none;
    border-radius: 4px;
    background: #ecf0f1;
    color: #2c3e50;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 0.8rem;
}

.alerta-btn:hover {
    background: #bdc3c7;
    transform: scale(1.1);
}

.agenda-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
    max-height: 300px;
    overflow-y: auto;
}

.agenda-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #3498db;
}

.agenda-time {
    color: #7f8c8d;
    font-size: 0.85rem;
    min-width: 60px;
    font-weight: 500;
}

.agenda-content {
    flex: 1;
}

.agenda-title {
    color: #2c3e50;
    font-weight: 500;
    margin-bottom: 5px;
}

.agenda-subgrupo {
    color: #7f8c8d;
    font-size: 0.85rem;
}

.agenda-status {
    min-width: 80px;
}

.agenda-actions {
    display: flex;
    gap: 5px;
}

.agenda-btn {
    padding: 6px;
    border: none;
    border-radius: 4px;
    background: #ecf0f1;
    color: #2c3e50;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 0.8rem;
}

.agenda-btn:hover {
    background: #bdc3c7;
    transform: scale(1.1);
}

.no-data {
    text-align: center;
    color: #7f8c8d;
    padding: 40px 20px;
    font-style: italic;
}

.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
}

.modal-content {
    background-color: white;
    margin: 5% auto;
    padding: 0;
    border-radius: 12px;
    width: 90%;
    max-width: 800px;
    max-height: 80vh;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.modal-header {
    background: #f8f9fa;
    padding: 20px;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    color: #2c3e50;
    margin: 0;
    font-size: 1.3rem;
}

.modal-close {
    color: #7f8c8d;
    font-size: 1.5rem;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.3s;
}

.modal-close:hover {
    color: #2c3e50;
}

.modal-body {
    padding: 25px;
    max-height: 60vh;
    overflow-y: auto;
}

.modal-footer {
    background: #f8f9fa;
    padding: 20px;
    border-top: 1px solid #dee2e6;
    display: flex;
    justify-content: flex-end;
    gap: 15px;
}

.modal-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s;
}

.modal-btn.primary {
    background: #3498db;
    color: white;
}

.modal-btn.primary:hover {
    background: #2980b9;
}

.modal-btn.secondary {
    background: #95a5a6;
    color: white;
}

.modal-btn.secondary:hover {
    background: #7f8c8d;
}

.modal-btn.warning {
    background: #f39c12;
    color: white;
}

.modal-btn.warning:hover {
    background: #e67e22;
}

@media (max-width: 768px) {
    .ajustepreventiva-page {
        padding: 10px;
    }
    
    .summary-container {
        grid-template-columns: 1fr;
    }
    
    .controls-container {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .grid-container {
        grid-template-columns: 1fr;
    }
    
    .dashboard-container {
        grid-template-columns: 1fr;
    }
    
    .filter-controls {
        grid-template-columns: 1fr;
    }
    
    .summary-metrics {
        grid-template-columns: 1fr;
    }
    
    .config-grid {
        grid-template-columns: 1fr;
    }
    
    .historico-stats {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .modal-content {
        width: 95%;
        margin: 2% auto;
    }
}

@media (max-width: 480px) {
    .page-title h2 {
        font-size: 2rem;
    }
    
    .breadcrumb-nav {
        flex-direction: column;
        gap: 5px;
    }
    
    .action-buttons {
        gap: 10px;
    }
    
    .subgrupo-header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
    }
    
    .subgrupo-actions {
        align-self: stretch;
        justify-content: space-between;
    }
    
    .historico-stats {
        grid-template-columns: 1fr;
    }
    
    .controls-row {
        flex-direction: column;
    }
    
    .config-actions {
        flex-direction: column;
    }
    
    .modal-footer {
        flex-direction: column;
    }
}
</style>

<script>
// Variáveis globais
let currentSubgrupo = null;
let filtrosAtivos = {};

// Funções de inicialização
document.addEventListener('DOMContentLoaded', function() {
    initializeEventListeners();
    loadInitialData();
});

function initializeEventListeners() {
    // Event listeners para modais
    document.querySelectorAll('.modal-close').forEach(closeBtn => {
        closeBtn.addEventListener('click', closeModal);
    });
    
    window.addEventListener('click', function(event) {
        if (event.target.classList.contains('modal')) {
            closeModal();
        }
    });
    
    // Event listeners para filtros
    document.getElementById('filter-subgrupo').addEventListener('change', aplicarFiltros);
    document.getElementById('filter-status').addEventListener('change', aplicarFiltros);
    document.getElementById('filter-prioridade').addEventListener('change', aplicarFiltros);
    document.getElementById('filter-valor-min').addEventListener('input', debounce(aplicarFiltros, 500));
}

function loadInitialData() {
    // Carregar dados iniciais se necessário
    console.log('Dados iniciais carregados');
}

// Funções de ações rápidas
function executarAjusteGeral() {
    if (confirm('Deseja executar o ajuste geral para todos os subgrupos? Esta ação não pode ser desfeita.')) {
        showNotification('Executando ajuste geral...', 'info');
        
        // Simular execução
        setTimeout(() => {
            showNotification('Ajuste geral executado com sucesso!', 'success');
            location.reload();
        }, 3000);
    }
}

function simularAjustes() {
    showNotification('Iniciando simulação de ajustes...', 'info');
    
    // Simular simulação
    setTimeout(() => {
        const modal = document.getElementById('parametros-modal');
        document.getElementById('parametros-content').innerHTML = `
            <div class="simulacao-resultado">
                <h4>📊 Resultado da Simulação</h4>
                <div class="resultado-grid">
                    <div class="resultado-item">
                        <div class="resultado-label">Subgrupos Afetados:</div>
                        <div class="resultado-value">15</div>
                    </div>
                    <div class="resultado-item">
                        <div class="resultado-label">Itens para Ajuste:</div>
                        <div class="resultado-value">247</div>
                    </div>
                    <div class="resultado-item">
                        <div class="resultado-label">Valor Total:</div>
                        <div class="resultado-value">R$ 8.450,00</div>
                    </div>
                    <div class="resultado-item">
                        <div class="resultado-label">Economia Estimada:</div>
                        <div class="resultado-value success">R$ 2.130,00</div>
                    </div>
                </div>
                <div class="simulacao-detalhes">
                    <h5>Detalhes por Subgrupo:</h5>
                    <div class="detalhes-lista">
                        <div class="detalhe-item">
                            <span>Hortifruti: 89 itens - R$ 3.200,00</span>
                        </div>
                        <div class="detalhe-item">
                            <span>Frios: 67 itens - R$ 2.800,00</span>
                        </div>
                        <div class="detalhe-item">
                            <span>Mercearia: 91 itens - R$ 2.450,00</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
        modal.style.display = 'block';
    }, 2000);
}

function exportarRelatorio() {
    showNotification('Gerando relatório...', 'info');
    
    // Simular exportação
    setTimeout(() => {
        const link = document.createElement('a');
        link.href = '#';
        link.download = `relatorio_ajuste_preventiva_${new Date().toISOString().split('T')[0]}.xlsx`;
        link.click();
        showNotification('Relatório exportado com sucesso!', 'success');
    }, 2000);
}

function configurarParametros() {
    const modal = document.getElementById('parametros-modal');
    document.getElementById('parametros-content').innerHTML = `
        <div class="parametros-globais">
            <div class="param-section">
                <h4>⚙️ Configurações Gerais</h4>
                <div class="param-grid">
                    <div class="param-item">
                        <label>Limite Global de Ajuste (%):</label>
                        <input type="number" id="limite-global" value="15" min="0" max="100" step="0.1">
                    </div>
                    <div class="param-item">
                        <label>Valor Mínimo Global (R$):</label>
                        <input type="number" id="valor-global" value="5.00" min="0" step="0.01">
                    </div>
                    <div class="param-item">
                        <label>Frequência Padrão:</label>
                        <select id="frequencia-global">
                            <option value="diario">Diário</option>
                            <option value="semanal" selected>Semanal</option>
                            <option value="mensal">Mensal</option>
                        </select>
                    </div>
                    <div class="param-item">
                        <label>Ajuste Automático Global:</label>
                        <input type="checkbox" id="auto-global" checked>
                    </div>
                </div>
            </div>
            
            <div class="param-section">
                <h4>🔔 Notificações Globais</h4>
                <div class="param-grid">
                    <div class="param-item">
                        <label>Email Principal:</label>
                        <input type="email" id="email-global" value="admin@empresa.com">
                    </div>
                    <div class="param-item">
                        <label>Notificar Sucessos:</label>
                        <input type="checkbox" id="notif-sucesso-global" checked>
                    </div>
                    <div class="param-item">
                        <label>Notificar Erros:</label>
                        <input type="checkbox" id="notif-erro-global" checked>
                    </div>
                    <div class="param-item">
                        <label>Relatórios Automáticos:</label>
                        <input type="checkbox" id="relatorio-auto-global">
                    </div>
                </div>
            </div>
            
            <div class="param-section">
                <h4>🛡️ Segurança e Backup</h4>
                <div class="param-grid">
                    <div class="param-item">
                        <label>Backup Automático:</label>
                        <input type="checkbox" id="backup-auto" checked>
                    </div>
                    <div class="param-item">
                        <label>Retenção de Logs (dias):</label>
                        <input type="number" id="retencao-logs" value="30" min="1" max="365">
                    </div>
                    <div class="param-item">
                        <label>Confirmação para Ajustes Grandes:</label>
                        <input type="checkbox" id="confirmacao-grandes" checked>
                    </div>
                    <div class="param-item">
                        <label>Limite para Confirmação (R$):</label>
                        <input type="number" id="limite-confirmacao" value="1000.00" min="0" step="0.01">
                    </div>
                </div>
            </div>
        </div>
    `;
    modal.style.display = 'block';
}

// Funções de filtros
function aplicarFiltros() {
    const subgrupo = document.getElementById('filter-subgrupo').value;
    const status = document.getElementById('filter-status').value;
    const prioridade = document.getElementById('filter-prioridade').value;
    const valorMin = document.getElementById('filter-valor-min').value;
    
    filtrosAtivos = {
        subgrupo: subgrupo !== 'all' ? subgrupo : null,
        status: status !== 'all' ? status : null,
        prioridade: prioridade !== 'all' ? prioridade : null,
        valorMin: valorMin ? parseFloat(valorMin) : null
    };
    
    filtrarSubgrupos();
}

function limparFiltros() {
    document.getElementById('filter-subgrupo').value = 'all';
    document.getElementById('filter-status').value = 'all';
    document.getElementById('filter-prioridade').value = 'all';
    document.getElementById('filter-valor-min').value = '';
    
    filtrosAtivos = {};
    filtrarSubgrupos();
}

function filtrarSubgrupos() {
    const subgrupos = document.querySelectorAll('.subgrupo-box');
    
    subgrupos.forEach(subgrupo => {
        let mostrar = true;
        
        if (filtrosAtivos.subgrupo && subgrupo.dataset.subgrupo !== filtrosAtivos.subgrupo) {
            mostrar = false;
        }
        
        if (filtrosAtivos.status && subgrupo.dataset.status !== filtrosAtivos.status) {
            mostrar = false;
        }
        
        if (filtrosAtivos.prioridade && subgrupo.dataset.prioridade !== filtrosAtivos.prioridade) {
            mostrar = false;
        }
        
        if (filtrosAtivos.valorMin && parseFloat(subgrupo.dataset.valor) < filtrosAtivos.valorMin) {
            mostrar = false;
        }
        
        subgrupo.style.display = mostrar ? 'block' : 'none';
    });
}

// Funções de subgrupos
function toggleSubgrupo(codigo) {
    const content = document.getElementById(`content-${codigo}`);
    const isVisible = content.style.display !== 'none';
    
    content.style.display = isVisible ? 'none' : 'block';
    
    if (!isVisible) {
        // Carregar dados do subgrupo se necessário
        loadSubgrupoData(codigo);
    }
}

function executarAjuste(codigo) {
    if (confirm(`Deseja executar o ajuste para o subgrupo ${codigo}?`)) {
        showNotification(`Executando ajuste para ${codigo}...`, 'info');
        
        // Simular execução
        setTimeout(() => {
            showNotification(`Ajuste para ${codigo} executado com sucesso!`, 'success');
            updateSubgrupoStatus(codigo, 'concluido');
        }, 2000);
    }
}

function simularAjuste(codigo) {
    showNotification(`Simulando ajuste para ${codigo}...`, 'info');
    
    // Simular simulação
    setTimeout(() => {
        showNotification(`Simulação para ${codigo} concluída. Verifique os resultados.`, 'success');
    }, 1500);
}

function configurarSubgrupo(codigo) {
    currentSubgrupo = codigo;
    showTab(codigo, 'configuracao');
    toggleSubgrupo(codigo);
}

function loadSubgrupoData(codigo) {
    // Simular carregamento de dados
    console.log(`Carregando dados para subgrupo ${codigo}`);
}

function updateSubgrupoStatus(codigo, novoStatus) {
    const subgrupo = document.querySelector(`[data-subgrupo="${codigo}"]`);
    if (subgrupo) {
        subgrupo.dataset.status = novoStatus;
        const statusBadge = subgrupo.querySelector('.status-badge');
        if (statusBadge) {
            statusBadge.className = `status-badge ${novoStatus}`;
            statusBadge.textContent = getStatusText(novoStatus);
        }
    }
}

function getStatusText(status) {
    const statusTexts = {
        'pendente': 'Pendente',
        'processando': 'Processando',
        'concluido': 'Concluído',
        'erro': 'Erro'
    };
    return statusTexts[status] || status;
}

// Funções de tabs
function showTab(subgrupo, tabName) {
    // Esconder todas as tabs
    const tabs = document.querySelectorAll(`[id^="tab-"][id$="-${subgrupo}"]`);
    tabs.forEach(tab => {
        tab.style.display = 'none';
    });
    
    // Remover classe active de todos os botões
    const tabBtns = document.querySelectorAll(`#content-${subgrupo} .tab-btn`);
    tabBtns.forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Mostrar tab selecionada
    const selectedTab = document.getElementById(`tab-${tabName}-${subgrupo}`);
    if (selectedTab) {
        selectedTab.style.display = 'block';
    }
    
    // Adicionar classe active ao botão
    const selectedBtn = document.querySelector(`#content-${subgrupo} .tab-btn[onclick*="${tabName}"]`);
    if (selectedBtn) {
        selectedBtn.classList.add('active');
    }
}

// Funções de itens
function selecionarTodos(subgrupo) {
    const checkboxes = document.querySelectorAll(`#tab-itens-${subgrupo} .item-checkbox`);
    checkboxes.forEach(checkbox => {
        checkbox.checked = true;
    });
}

function desselecionarTodos(subgrupo) {
    const checkboxes = document.querySelectorAll(`#tab-itens-${subgrupo} .item-checkbox`);
    checkboxes.forEach(checkbox => {
        checkbox.checked = false;
    });
}

function toggleSelectAll(subgrupo) {
    const selectAllCheckbox = document.getElementById(`select-all-${subgrupo}`);
    const itemCheckboxes = document.querySelectorAll(`#tab-itens-${subgrupo} .item-checkbox`);
    
    itemCheckboxes.forEach(checkbox => {
        checkbox.checked = selectAllCheckbox.checked;
    });
}

function ajustarSelecionados(subgrupo) {
    const selecionados = document.querySelectorAll(`#tab-itens-${subgrupo} .item-checkbox:checked`);
    
    if (selecionados.length === 0) {
        showNotification('Nenhum item selecionado', 'warning');
        return;
    }
    
    if (confirm(`Deseja ajustar ${selecionados.length} itens selecionados?`)) {
        showNotification(`Ajustando ${selecionados.length} itens...`, 'info');
        
        // Simular ajuste
        setTimeout(() => {
            showNotification(`${selecionados.length} itens ajustados com sucesso!`, 'success');
            desselecionarTodos(subgrupo);
        }, 2000);
    }
}

function exportarItens(subgrupo) {
    showNotification(`Exportando itens do subgrupo ${subgrupo}...`, 'info');
    
    // Simular exportação
    setTimeout(() => {
        const link = document.createElement('a');
        link.href = '#';
        link.download = `itens_${subgrupo}_${new Date().toISOString().split('T')[0]}.xlsx`;
        link.click();
        showNotification('Itens exportados com sucesso!', 'success');
    }, 1500);
}

function ajustarItem(subgrupo, mercadoria) {
    if (confirm(`Deseja ajustar o item ${mercadoria}?`)) {
        showNotification(`Ajustando item ${mercadoria}...`, 'info');
        
        // Simular ajuste
        setTimeout(() => {
            showNotification(`Item ${mercadoria} ajustado com sucesso!`, 'success');
        }, 1000);
    }
}

function editarItem(subgrupo, mercadoria) {
    const modal = document.getElementById('item-details-modal');
    document.getElementById('item-details-content').innerHTML = `
        <div class="item-edit-form">
            <h4>✏️ Editar Item: ${mercadoria}</h4>
            <div class="edit-grid">
                <div class="edit-item">
                    <label>Estoque Atual:</label>
                    <input type="number" id="edit-estoque-atual" value="150" step="0.01">
                </div>
                <div class="edit-item">
                    <label>Estoque Sugerido:</label>
                    <input type="number" id="edit-estoque-sugerido" value="145" step="0.01">
                </div>
                <div class="edit-item">
                    <label>Motivo do Ajuste:</label>
                    <select id="edit-motivo">
                        <option value="contagem">Contagem Física</option>
                        <option value="avaria">Avaria</option>
                        <option value="vencimento">Vencimento</option>
                        <option value="outros">Outros</option>
                    </select>
                </div>
                <div class="edit-item">
                    <label>Observações:</label>
                    <textarea id="edit-observacoes" rows="3" placeholder="Observações adicionais..."></textarea>
                </div>
            </div>
        </div>
    `;
    modal.style.display = 'block';
}

function verDetalhes(subgrupo, mercadoria) {
    const modal = document.getElementById('item-details-modal');
    document.getElementById('item-details-content').innerHTML = `
        <div class="item-details">
            <h4>👁️ Detalhes do Item: ${mercadoria}</h4>
            <div class="details-grid">
                <div class="detail-section">
                    <h5>📦 Informações Básicas</h5>
                    <div class="detail-row">
                        <span class="detail-label">Código:</span>
                        <span class="detail-value">${mercadoria}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Descrição:</span>
                        <span class="detail-value">Produto de exemplo para demonstração</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Subgrupo:</span>
                        <span class="detail-value">${subgrupo}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Unidade:</span>
                        <span class="detail-value">UN</span>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h5>📊 Estoque</h5>
                    <div class="detail-row">
                        <span class="detail-label">Estoque Atual:</span>
                        <span class="detail-value">150</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estoque Sugerido:</span>
                        <span class="detail-value">145</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Diferença:</span>
                        <span class="detail-value negative">-5</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Valor do Ajuste:</span>
                        <span class="detail-value">R$ 25,00</span>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h5>📈 Histórico</h5>
                    <div class="historico-mini">
                        <div class="historico-mini-item">
                            <span class="mini-date">15/01/2024</span>
                            <span class="mini-action">Ajuste: -3</span>
                            <span class="mini-value">R$ 15,00</span>
                        </div>
                        <div class="historico-mini-item">
                            <span class="mini-date">10/01/2024</span>
                            <span class="mini-action">Ajuste: +2</span>
                            <span class="mini-value">R$ 10,00</span>
                        </div>
                        <div class="historico-mini-item">
                            <span class="mini-date">05/01/2024</span>
                            <span class="mini-action">Contagem</span>
                            <span class="mini-value">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    modal.style.display = 'block';
}

// Funções de configuração
function salvarConfiguracao(subgrupo, event) {
    event.preventDefault();
    
    const config = {
        limite_ajuste: document.getElementById(`limite-ajuste-${subgrupo}`).value,
        valor_minimo: document.getElementById(`valor-minimo-${subgrupo}`).value,
        frequencia: document.getElementById(`frequencia-${subgrupo}`).value,
        auto_ajuste: document.getElementById(`auto-ajuste-${subgrupo}`).checked,
        email: document.getElementById(`notif-email-${subgrupo}`).value,
        notif_sucesso: document.getElementById(`notif-sucesso-${subgrupo}`).checked,
        notif_erro: document.getElementById(`notif-erro-${subgrupo}`).checked,
        notif_limite: document.getElementById(`notif-limite-${subgrupo}`).checked
    };
    
    showNotification(`Salvando configuração para ${subgrupo}...`, 'info');
    
    // Simular salvamento
    setTimeout(() => {
        showNotification(`Configuração para ${subgrupo} salva com sucesso!`, 'success');
    }, 1000);
}

function resetarConfiguracao(subgrupo) {
    if (confirm(`Deseja resetar a configuração do subgrupo ${subgrupo} para os valores padrão?`)) {
        // Resetar valores para padrão
        document.getElementById(`limite-ajuste-${subgrupo}`).value = '10';
        document.getElementById(`valor-minimo-${subgrupo}`).value = '1.00';
        document.getElementById(`frequencia-${subgrupo}`).value = 'semanal';
        document.getElementById(`auto-ajuste-${subgrupo}`).checked = false;
        document.getElementById(`notif-email-${subgrupo}`).value = '';
        document.getElementById(`notif-sucesso-${subgrupo}`).checked = true;
        document.getElementById(`notif-erro-${subgrupo}`).checked = true;
        document.getElementById(`notif-limite-${subgrupo}`).checked = false;
        
        showNotification(`Configuração para ${subgrupo} resetada!`, 'success');
    }
}

function testarConfiguracao(subgrupo) {
    showNotification(`Testando configuração para ${subgrupo}...`, 'info');
    
    // Simular teste
    setTimeout(() => {
        showNotification(`Teste para ${subgrupo} concluído com sucesso!`, 'success');
    }, 2000);
}

// Funções de logs
function atualizarLogs(subgrupo) {
    showNotification(`Atualizando logs para ${subgrupo}...`, 'info');
    
    // Simular atualização
    setTimeout(() => {
        showNotification('Logs atualizados!', 'success');
    }, 1000);
}

function limparLogs(subgrupo) {
    if (confirm(`Deseja limpar todos os logs do subgrupo ${subgrupo}?`)) {
        showNotification(`Limpando logs para ${subgrupo}...`, 'info');
        
        // Simular limpeza
        setTimeout(() => {
            document.getElementById(`logs-content-${subgrupo}`).innerHTML = '<div class="no-data"><p>Nenhum log disponível</p></div>';
            showNotification('Logs limpos!', 'success');
        }, 1000);
    }
}

function exportarLogs(subgrupo) {
    showNotification(`Exportando logs para ${subgrupo}...`, 'info');
    
    // Simular exportação
    setTimeout(() => {
        const link = document.createElement('a');
        link.href = '#';
        link.download = `logs_${subgrupo}_${new Date().toISOString().split('T')[0]}.txt`;
        link.click();
        showNotification('Logs exportados!', 'success');
    }, 1500);
}

function toggleLogDetails(index) {
    const details = document.getElementById(`details-${index}`);
    const isVisible = details.style.display !== 'none';
    details.style.display = isVisible ? 'none' : 'block';
}

// Funções de dashboard
function atualizarPerformance() {
    showNotification('Atualizando dados de performance...', 'info');
    
    // Simular atualização
    setTimeout(() => {
        showNotification('Performance atualizada!', 'success');
    }, 1000);
}

function exportarPerformance() {
    showNotification('Exportando dados de performance...', 'info');
    
    // Simular exportação
    setTimeout(() => {
        const link = document.createElement('a');
        link.href = '#';
        link.download = `performance_${new Date().toISOString().split('T')[0]}.xlsx`;
        link.click();
        showNotification('Performance exportada!', 'success');
    }, 1500);
}

function atualizarAlertas() {
    showNotification('Atualizando alertas...', 'info');
    
    // Simular atualização
    setTimeout(() => {
        showNotification('Alertas atualizados!', 'success');
    }, 1000);
}

function marcarTodosLidos() {
    const alertas = document.querySelectorAll('.alerta-item');
    alertas.forEach(alerta => {
        alerta.style.opacity = '0.6';
    });
    showNotification('Todos os alertas marcados como lidos!', 'success');
}

function resolverAlerta(id) {
    const alerta = document.querySelector(`[data-alerta-id="${id}"]`);
    if (alerta) {
        alerta.remove();
        showNotification('Alerta resolvido!', 'success');
    }
}

function verDetalhesAlerta(id) {
    showNotification(`Carregando detalhes do alerta ${id}...`, 'info');
}

function atualizarAgenda() {
    showNotification('Atualizando agenda...', 'info');
    
    // Simular atualização
    setTimeout(() => {
        showNotification('Agenda atualizada!', 'success');
    }, 1000);
}

function adicionarAgenda() {
    showNotification('Abrindo formulário para nova agenda...', 'info');
}

function executarAgenda(id) {
    if (confirm(`Deseja executar a agenda ${id}?`)) {
        showNotification(`Executando agenda ${id}...`, 'info');
        
        // Simular execução
        setTimeout(() => {
            showNotification(`Agenda ${id} executada!`, 'success');
        }, 2000);
    }
}

function editarAgenda(id) {
    showNotification(`Editando agenda ${id}...`, 'info');
}

// Funções de modal
function closeModal() {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        modal.style.display = 'none';
    });
}

function salvarParametrosGlobais() {
    showNotification('Salvando parâmetros globais...', 'info');
    
    // Simular salvamento
    setTimeout(() => {
        showNotification('Parâmetros globais salvos!', 'success');
        closeModal();
    }, 1000);
}

function resetarParametrosGlobais() {
    if (confirm('Deseja resetar todos os parâmetros globais?')) {
        showNotification('Parâmetros resetados!', 'success');
    }
}

function ajustarItemModal() {
    showNotification('Ajustando item...', 'info');
    
    // Simular ajuste
    setTimeout(() => {
        showNotification('Item ajustado com sucesso!', 'success');
        closeModal();
    }, 1000);
}

function editarItemModal() {
    showNotification('Salvando alterações...', 'info');
    
    // Simular salvamento
    setTimeout(() => {
        showNotification('Alterações salvas!', 'success');
        closeModal();
    }, 1000);
}

// Funções utilitárias
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <span class="notification-icon">
                ${type === 'success' ? '✅' : type === 'error' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️'}
            </span>
            <span class="notification-message">${message}</span>
        </div>
    `;
    
    // Adicionar estilos se não existirem
    if (!document.querySelector('#notification-styles')) {
        const styles = document.createElement('style');
        styles.id = 'notification-styles';
        styles.textContent = `
            .notification {
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 10000;
                min-width: 300px;
                animation: slideIn 0.3s ease;
            }
            
            .notification.success {
                border-left: 4px solid #27ae60;
            }
            
            .notification.error {
                border-left: 4px solid #e74c3c;
            }
            
            .notification.warning {
                border-left: 4px solid #f39c12;
            }
            
            .notification.info {
                border-left: 4px solid #3498db;
            }
            
            .notification-content {
                display: flex;
                align-items: center;
                gap: 10px;
                padding: 15px;
            }
            
            .notification-icon {
                font-size: 1.2rem;
            }
            
            .notification-message {
                flex: 1;
                color: #2c3e50;
                font-weight: 500;
            }
            
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(styles);
    }
    
    document.body.appendChild(notification);
    
    // Remover após 4 segundos
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 4000);
}

function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

function configurarSubgrupos() {
    showNotification('Abrindo configuração de subgrupos...', 'info');
    // Implementar configuração de subgrupos
}
</script>

{% endblock %}